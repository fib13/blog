<!doctype html><html><head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<link rel=canonical href=https://www.shisanshiji.com/operation-guide/kubernetes-%E5%BA%94%E7%94%A8%E4%BD%BF%E7%94%A8-keycloak-%E4%B8%8E-oauth2-proxy-%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81/>
<title>
使用 Keycloak 与 Oauth2-Proxy 认证 Kubernetes 应用 | 十三时记
</title>
<link href=https://www.shisanshiji.com/css/fontawesome.min.css rel=stylesheet>
<link rel=stylesheet href=https://www.shisanshiji.com/css/ace.min.css>
<link rel=icon href=https://www.shisanshiji.com/img/favicon.png type=image/x-icon>
</head>
<body><nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow sticky-top" id=navbarMain>
<div class=container>
<div>
<a class=navbar-brand href=/>
十三时记
</a>
</div>
<button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#navbarMainCollapse aria-controls=navbarMainCollapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarMainCollapse>
<ul class="navbar-nav ml-auto">
<li class=nav-item>
<a class=nav-link href=https://github.com/jugggao target=_blank>
<i class="fab fa-github"></i>
</a>
</li>
</ul>
</div>
</div>
</nav>
<div class=container-fluid>
<div class=row>
<div class="docs-sidenav order-0 col-12 col-md-3 col-lg-2 col-xl-2 position-sticky border-right"><nav class="navbar navbar-expand-md navbar-light pl-0">
<button class="navbar-toggler navbar-toggler-right collapsed" type=button data-toggle=collapse data-target=#sidenav-left-collapse aria-controls=sidenav-left-collapse aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse align-items-start flex-column" id=sidenav-left-collapse>
<form class="form-inline my-2 my-lg-0 searchbox">
<input class="form-control mr-sm-2 w-100" data-search-input id=search-by type=text placeholder=Search>
</form>
<ul class="navbar-nav flex-column pt-3">
<li data-nav-id=/learning-notes/ class="nav-item my-1 haschildren">
<a class="nav-link p-0" href=/learning-notes/><h6>学习笔记</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/learning-notes/golang/ class="nav-item my-1 haschildren">
<a class="nav-link p-0" href=/learning-notes/golang/><h6>Golang 学习笔记</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/learning-notes/golang/go-install/ class="nav-item my-1">
<a href=/learning-notes/golang/go-install/ class="nav-link p-0">
Go 安装
</a>
</li>
<li data-nav-id=/learning-notes/golang/go-tutorial/ class="nav-item my-1">
<a href=/learning-notes/golang/go-tutorial/ class="nav-link p-0">
Golang 教程
</a>
</li>
</ul>
</li>
</ul>
</li>
<li data-nav-id=/operation-guide/ class="nav-item my-1 parent haschildren">
<a class="nav-link p-0" href=/operation-guide/><h6>操作指南</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/operation-guide/hugo-githubactiongithub-pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ class="nav-item my-1">
<a href=/operation-guide/hugo-githubactiongithub-pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ class="nav-link p-0">
Hugo&Github Action&Github Pages 搭建个人博客
</a>
</li>
<li data-nav-id=/operation-guide/kubernetes-%E5%BA%94%E7%94%A8%E4%BD%BF%E7%94%A8-keycloak-%E4%B8%8E-oauth2-proxy-%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81/ class="nav-item my-1 active">
<a href=/operation-guide/kubernetes-%E5%BA%94%E7%94%A8%E4%BD%BF%E7%94%A8-keycloak-%E4%B8%8E-oauth2-proxy-%E8%BF%9B%E8%A1%8C%E8%AE%A4%E8%AF%81/ class="nav-link p-0">
使用 Keycloak 与 Oauth2-Proxy 认证 Kubernetes 应用
</a>
</li>
</ul>
</li>
<li data-nav-id=/troubleshooting/ class="nav-item my-1 haschildren">
<a class="nav-link p-0" href=/troubleshooting/><h6>问题排查</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/troubleshooting/elasticsearch-troubleshooting/ class="nav-item my-1">
<a href=/troubleshooting/elasticsearch-troubleshooting/ class="nav-link p-0">
Elasticsearch 问题排查
</a>
</li>
</ul>
</li>
<li data-nav-id=/devops/ class="nav-item my-1 haschildren">
<a class="nav-link p-0" href=/devops/><h6>DevOps</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/devops/tekton/ class="nav-item my-1 haschildren">
<a class="nav-link p-0" href=/devops/tekton/><h6>Tekton CICD</h6></a>
<ul class="list-unstyled ml-2">
<li data-nav-id=/devops/tekton/tekton-practice-task/ class="nav-item my-1">
<a href=/devops/tekton/tekton-practice-task/ class="nav-link p-0">
Tekton 实践：安装
</a>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</nav>
</div>
<div class="docs-toc large order-lg-2 order-md-0 order-xs-1 col-12 col-lg-2 col-xl-2 position-sticky border-left"><div class=docs-toc>
<nav id=TableOfContents>
<ul>
<li><a href=#安装-keycloak-operator>安装 Keycloak-Operator</a></li>
</ul>
</nav>
</div>
</div>
<div class="main col-12 order-1 col-md-9 col-lg-10 col-xl-8 py-3">
<h1>使用 Keycloak 与 Oauth2-Proxy 认证 Kubernetes 应用</h1>
<h2 id=安装-keycloak-operator>安装 Keycloak-Operator</h2>
<div class=highlight><pre tabindex=0 style=color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=color:#75715e># 1. 创建 keycloak 命名空间</span>
kubectl create ns keycloak

<span style=color:#75715e># 2. 创建 serviceaccount</span>
kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/service_account.yaml

<span style=color:#75715e># 3. 创建 Role 和 Rolebinding（Namspace 范围）</span>
kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/role.yaml
kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/role_binding.yaml

<span style=color:#75715e># 这里创建的 keycloak-operator 为 namespace 范围，operator 只作用于 keycloak 这个 namespace 下。</span>
<span style=color:#75715e># 如果需要 cluster 范围，需要改用 ClusterRole 和 ClusterRoleBinding</span>
<span style=color:#75715e># kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/cluster_roles/cluster_role.yaml</span>
<span style=color:#75715e># kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/cluster_roles/cluster_role_binding.yaml</span>


<span style=color:#75715e># 3. 安装 crds</span>
kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/crds/keycloak.org_keycloaks_crd.yaml
kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/crds/keycloak.org_keycloakusers_crd.yaml
kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/crds/keycloak.org_keycloakrealms_crd.yaml
kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/crds/keycloak.org_keycloakclients_crd.yaml
kubectl apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/crds/keycloak.org_keycloakbackups_crd.yaml

<span style=color:#75715e># 安装 keycloak-operator</span>
kubectl -n keycloak apply -f https://raw.githubusercontent.com/keycloak/keycloak-operator/master/deploy/operator.yaml
</code></pre></div>
<div class=row><div class="position-relative mx-auto col-lg-9">
<div class="bg-primary overflow-hidden p-3 mt-5 shadow">
<h4 class="text-white text-center">阅读更多</h4>
<div class="d-flex justify-content-center"><a class="p-1 mr-3 d-inline-block text-white" href=/operation-guide/hugo-githubactiongithub-pages-%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/ title="Hugo&Github Action&Github Pages 搭建个人博客"><i class="fas fa-chevron-left p-1"></i>Hugo&Github Action&Github Pages 搭建个人博客</a>
<a class="p-1 ml-3 d-inline-block text-white text-right" href=/troubleshooting/ title=问题排查>问题排查<i class="fas fa-chevron-right p-1"></i></a>
</div>
</div>
</div></div>
</div>
</div>
</div>
<script src=https://www.shisanshiji.com/lib/jquery.min.js></script>
<script src=https://www.shisanshiji.com/lib/popper.min.js></script>
<script src=https://www.shisanshiji.com/js/bootstrap.min.js></script>
<script type=text/javascript src=/plugins/lunr.min.js></script>
<script type=text/javascript src=/plugins/auto-complete.js></script>
<link href=/plugins/auto-complete.css rel=stylesheet>
<script type=text/javascript>var baseurl="https://www.shisanshiji.com/"</script>
<script type=text/javascript src=/plugins/search.js></script>
<script type=text/javascript src=/plugins/clipboard.js></script>
<script>new ClipboardJS('.btn')</script>
</body>
</html>